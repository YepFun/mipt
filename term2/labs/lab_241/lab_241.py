import numpy as np
import matplotlib.pyplot as plt

# Исходные данные
T = np.array([20.05, 21.005, 22.055, 23.03, 24.00, 25.025, 26.00, 27.00, 
              28.015, 29.01, 30.03, 31.005, 32.06, 33.03, 34.03, 35.005, 
              35.985, 37.005, 37.995, 39.015, 40.005])  # Температура в °C

P = np.array([4482.7776, 4963.0752, 5224.57056, 5682.63216, 6104.22672, 
              6533.82624, 6868.25568, 7306.7496, 7698.99264, 8196.1896,
              8688.93936, 8917.52544, 9552.5856, 10018.65216, 10524.74352,
              11327.90784, 11680.12608, 12337.42224, 13233.08832, 13860.14352,
              14364.456])  # Давление (Па)

dT = np.array([0.045, 0.005, 0.015, 0.01, 0.01, 0.005, 0.01, 0.0, 
               0.025, 0.0, 0.01, 0.005, 0.02, 0.01, 0.01, 0.005,
               0.005, 0.005, 0.005, 0.005, 0.005])  # Погрешность температуры

dP = np.array([112.06944, 71.1552, 44.472, 9.48736, 61.66784, 27.27616, 
               51.58752, 72.34112, 20.7536, 18.38176, 7.70848, 23.12544, 
               28.46208, 27.27616, 22.53248, 55.73824, 41.5072, 55.73824, 
               59.296, 20.16064, 20.7536])  # Погрешность давления

# Перевод температуры в Кельвины
T_K = T + 273.15  # Температура в Кельвинах
inv_T_K = 1 / T_K  # 1/T_K
lnP = np.log(P)  # lnP

# Расчет погрешностей
dT_K = dT  # Погрешность температуры в Кельвинах
d_inv_T_K = dT_K / (T_K**2)  # Погрешность для 1/T_K
d_lnP = dP / P  # Погрешность для lnP (относительная погрешность)

# Проверка количества элементов
print(f"Количество значений в T: {len(T)}")
print(f"Количество значений в P: {len(P)}")
print(f"Количество значений в dT: {len(dT)}")
print(f"Количество значений в dP: {len(dP)}")

# Подбор линейной регрессии (мнк) для ln(P) от 1/T_K
coeffs = np.polyfit(inv_T_K, lnP, 1)  # Коэффициенты прямой (угловой и свободный)
slope = coeffs[0]  # Угловой коэффициент
intercept = coeffs[1]  # Свободный член

# График 1: P(T) с погрешностями
plt.figure(figsize=(8, 6))
plt.errorbar(T, P, xerr=dT, yerr=dP, fmt='o', markersize=6, ecolor='red', capsize=3, label="Экспериментальные данные")

# Установка масштабов осей, чтобы все точки были видны
plt.xlim(min(T) - 1, max(T) + 1)  # Добавляем запас к осям
plt.ylim(min(P) - 500, max(P) + 500)

plt.xlabel("Температура T, °C")
plt.ylabel("Давление P, Па")
plt.title("Зависимость P от T с учетом погрешностей")
plt.grid(True, linestyle="--", alpha=0.7)
plt.legend()
plt.tight_layout()

# Сохранение графика 1
plt.savefig("images/graph1.png", dpi=300)
plt.close()

# График 2: ln(P) от 1/T_K с погрешностями
plt.figure(figsize=(8, 6))
plt.errorbar(inv_T_K, lnP, xerr=d_inv_T_K, yerr=d_lnP, fmt='o', markersize=6, ecolor='blue', capsize=3, label="Экспериментальные данные")

# Линия, полученная методом наименьших квадратов
plt.plot(inv_T_K, np.polyval(coeffs, inv_T_K), 'g--', label=f"Линия МНК: $y = {slope:.3f}x + {intercept:.3f}$")

# Установка масштабов осей
plt.xlim(min(inv_T_K) - 0.00001, max(inv_T_K) + 0.00001)
plt.ylim(min(lnP) - 0.05, max(lnP) + 0.05)

plt.xlabel("Обратная температура 1/T_K, 1/K")
plt.ylabel("Логарифм давления ln(P)")
plt.title("Зависимость ln(P) от 1/T_K с учетом погрешностей")
plt.grid(True, linestyle="--", alpha=0.7)
plt.legend()
plt.tight_layout()

# Сохранение графика 2
plt.savefig("images/graph2.png", dpi=300)
plt.close()

# Вывод углового коэффициента
print(f"Угловой коэффициент (slope) линии МНК: {slope:.3f}")

# Данные из таблицы
L = [53000, 49000, 58000, 51000, 43200, 42400, 42300, 43300, 45500, 
            31800, 36700, 44000, 38300, 49400, 41200, 34300, 50000, 46000, 32900]
dL = [3000, 2000, 2000, 1000, 1100, 1100, 1100, 900, 500, 300, 400, 600, 
             500, 700, 600, 600, 800, 600, 400]
T = np.array([294.16, 295.21, 296.18, 297.15, 298.18, 299.15, 300.15, 301.17, 302.16, 
              303.18, 304.16, 305.21, 306.18, 307.18, 308.16, 309.14, 310.16, 311.15, 312.16])
dT = 0.03
# Построение графика с погрешностями
plt.figure(figsize=(8, 6))
plt.errorbar(T, L, xerr=dT, yerr=dL, fmt='o', color='b', ecolor='r', capsize=3, label=r'$L(T)$')

# Подписи осей и заголовок
plt.xlabel("$T, K$")
plt.ylabel("$L$")
plt.title("График зависимости $L(T)$ с учётом погрешностей")
plt.legend()
plt.grid(True, linestyle='--', alpha=0.6)

# Показать график
plt.savefig("images/graph3.png")